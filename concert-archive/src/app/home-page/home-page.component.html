<!-- Hero: uses the first concert title/date as a featured album header -->
<div class="home-hero">
  <div class="hero-inner">
    <div class="hero-meta">
      <div class="hero-sub">Concert & Singles Archive</div>
      <h1 class="hero-title">{{ 'Ziad on Vimeo' }}</h1>
    </div>
    <div class="hero-cover" aria-hidden="true">
      <!-- decorative area, could be replaced with a real cover image later -->
      <div class="cover-placeholder">ðŸŽ¶</div>
    </div>
  </div>
  <!-- full-width cover image under the header -->
  <div class="hero-cover-full" role="img" aria-label="Korg portrait">
    <img src="/assets/korg-portrait.png" alt="Korg portrait" />
  </div>
</div>

<!-- Concert list: each concert as a card containing chapters and songs -->
<!-- Concerts presented as columns (one column per concert) -->
<div class="concert-table" role="table">
  <div class="concert-column" *ngFor="let c of concerts; let ci = index" role="column">
    <div class="concert-header">
      <div class="concert-title">{{ c.title }}</div>
      <div class="concert-date">{{ c.date }}</div>
      <div class="concert-desc" *ngIf="c.description">{{ c.description }}</div>
    </div>

    <div class="concert-body">
      <!-- Flatten chapters: show a single numbered list of songs per concert -->
      <mat-list>
        <mat-list-item *ngFor="let s of getAllSongs(c); let si = index" class="track-row">
          <div class="track-content">
            <div class="track-index">{{ si + 1 }}</div>
            <div class="song-info">
                <div class="song-main">
                  <button mat-button class="song-link" (click)="openPlayer(s)" [attr.title]="s.title">{{ shortTitle(s.title) }}</button>
                  <div class="song-duration">{{ s.duration }}</div>
                </div>
                <div class="song-desc" *ngIf="s.description">{{ s.description }}</div>
            </div>
          </div>
        </mat-list-item>
      </mat-list>
    </div>
  </div>
</div>

<!-- Movable player (fixed) -->
<div *ngIf="currentSong" class="movable-player" (click)="$event.stopPropagation()"
     [class.collapsed]="isCollapsed"
     [style.width.px]="playerWidth"
  [style.height.px]="isCollapsed ? null : playerHeight"
  [style.left.px]="playerLeft !== null ? playerLeft : null"
  [style.top.px]="playerTop"
     [style.right.px]="playerLeft === null ? playerRight : null">

  <div class="player-header" (mousedown)="startDrag($event)" (touchstart)="startDragTouch($event)">
    <div class="player-title">{{ shortTitle(currentSong?.title || '', 48) }}</div>
    <div class="player-actions">
      <button mat-icon-button (click)="toggleCollapse(); $event.stopPropagation()" aria-label="Toggle"><mat-icon>{{ isCollapsed ? 'open_in_full' : 'fullscreen_exit' }}</mat-icon></button>
      <button mat-icon-button (click)="closePlayer(); $event.stopPropagation()" aria-label="Close"><mat-icon>close</mat-icon></button>
    </div>
  </div>

  <div class="player-body" [attr.aria-hidden]="isCollapsed">
    <iframe *ngIf="currentEmbedUrl" [src]="currentEmbedUrl" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
    <div *ngIf="!currentEmbedUrl" class="no-embed">Video cannot be embedded.
      <button mat-button (click)="window.open(currentSong?.url, '_blank')">Open in new tab</button>
    </div>
  </div>

  <div class="player-compact" *ngIf="isCollapsed">
    <div class="compact-left" [attr.title]="currentSong?.title">{{ shortTitle(currentSong?.title || '', 36) }}</div>
    <div class="compact-actions">
      <button mat-icon-button (click)="expandPlayer(); $event.stopPropagation()" aria-label="Expand player"><mat-icon>open_in_full</mat-icon></button>
      <button mat-icon-button (click)="closePlayer(); $event.stopPropagation()" aria-label="Close player"><mat-icon>close</mat-icon></button>
    </div>
  </div>

  <!-- corner resize handles -->
  <div class="resize-handle top-left" title="Resize" (mousedown)="startCornerResize($event,'tl')" (touchstart)="startCornerResizeTouch($event,'tl')"></div>
  <div class="resize-handle top-right" title="Resize" (mousedown)="startCornerResize($event,'tr')" (touchstart)="startCornerResizeTouch($event,'tr')"></div>
  <div class="resize-handle bottom-left" title="Resize" (mousedown)="startCornerResize($event,'bl')" (touchstart)="startCornerResizeTouch($event,'bl')"></div>
  <div class="resize-handle bottom-right" title="Resize" (mousedown)="startCornerResize($event,'br')" (touchstart)="startCornerResizeTouch($event,'br')"></div>
</div>
