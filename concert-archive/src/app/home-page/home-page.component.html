<!-- Navigation: quick link to Albums page -->
<div class="page-actions" style="margin-bottom:12px;">
  <button mat-stroked-button color="primary" routerLink="/albums" aria-label="Go to albums">Albums</button>
</div>

<mat-accordion>
  <mat-expansion-panel *ngFor="let c of concerts">
    <mat-expansion-panel-header>
      <mat-panel-title>{{ c.title }}</mat-panel-title>
      <mat-panel-description>{{ c.date }}</mat-panel-description>
    </mat-expansion-panel-header>

    <mat-accordion>
      <mat-expansion-panel *ngFor="let ch of c.chapters">
        <mat-expansion-panel-header>
          <mat-panel-title>{{ ch.title }}</mat-panel-title>
        </mat-expansion-panel-header>

        <mat-list>
          <mat-list-item *ngFor="let s of ch.songs">
            
            <!-- song info: clickable concise title + duration -->
            <div class="song-info">
              <!-- clickable title (shows full title on hover) -->
              <button
                mat-button
                class="song-link"
                (click)="openPlayer(s)"
                [attr.title]="s.title"
                aria-label="Play {{ s.title }}">
                {{ shortTitle(s.title) }}
              </button>

              <div class="song-duration">{{ s.duration }}</div>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-expansion-panel>
</mat-accordion>

<!-- Full-size player overlay (expanded) -->
<div class="player-backdrop" *ngIf="currentSong && !isCollapsed" (click)="closePlayer()">
  <div class="player-container" (click)="$event.stopPropagation()">
    <div class="player-header">
      <div class="player-title">{{ currentSong?.title }}</div>
      <div class="player-controls">
        <button mat-icon-button (click)="collapsePlayer()" aria-label="Collapse player">
          <mat-icon>minimize</mat-icon>
        </button>
        <button mat-icon-button (click)="closePlayer()" aria-label="Close player">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <div class="player-body">
      <iframe
        *ngIf="currentEmbedUrl"
        [src]="currentEmbedUrl"
        frameborder="0"
        allow="autoplay; fullscreen; picture-in-picture"
        allowfullscreen>
      </iframe>

      <div *ngIf="!currentEmbedUrl" class="no-embed">
        Video cannot be embedded.
        <button mat-button (click)="window.open(currentSong?.url, '_blank')">Open in new tab</button>
      </div>
    </div>
  </div>
</div>

<!-- Docked player (bottom-right compact) -->
<div class="player-dock" *ngIf="currentSong && isCollapsed" (click)="$event.stopPropagation()">
  <div class="dock-content">
    <div class="dock-left">
      <div class="dock-title" [attr.title]="currentSong?.title">{{ shortTitle(currentSong?.title || '', 32) }}</div>
      <div class="dock-controls">
        <button mat-icon-button (click)="expandPlayer()" aria-label="Expand player">
          <mat-icon>open_in_full</mat-icon>
        </button>
        <button mat-icon-button (click)="closePlayer()" aria-label="Close player">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <div class="dock-video">
      <iframe
        *ngIf="currentEmbedUrl"
        [src]="currentEmbedUrl"
        frameborder="0"
        allow="autoplay; fullscreen; picture-in-picture"
        allowfullscreen>
      </iframe>
    </div>
  </div>
</div>
